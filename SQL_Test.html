<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCC Tooling System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 2rem;
            padding-bottom: 5rem;
        }

        .card {
            border: none;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .result-box {
            background-color: #e9ecef;
            border-radius: 5px;
            padding: 15px;
        }

        .section-title {
            border-left: 5px solid #0d6efd;
            padding-left: 10px;
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">

                <div class="text-center mb-4">
                    <h2>MCC Mill - 刀具選配系統</h2>
                    <p class="text-muted">請先選擇刀片，系統將自動篩選適用的刀桿</p>
                </div>

                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h5 class="section-title">Step 1: 選擇刀片 (Insert)</h5>

                        <div class="mb-3">
                            <label for="partsSelect" class="form-label">選擇 Parts No.:</label>
                            <select class="form-select" id="partsSelect">
                                <option selected disabled value="">請選擇刀片型號...</option>
                            </select>
                        </div>

                        <div id="insertInfo" class="d-none result-box">
                            <h6 class="text-primary fw-bold">刀片規格：</h6>
                            <div class="row font-monospace" style="font-size: 0.9rem;">
                                <div class="col-6">Code: <span id="insCode"></span></div>
                                <div class="col-6">Size: <span id="insSize" class="badge bg-warning text-dark"></span>
                                </div>
                                <div class="col-6">Coating: <span id="insCoat"></span></div>
                                <div class="col-6">Grade: <span id="insGrade"></span></div>
                                <div class="col-12">Pitch: <span id="insPitch"></span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="holderSection" class="card shadow-sm " style="pointer-events: none;">
                    <div class="card-body p-4">
                        <h5 class="section-title">Step 2: 選擇適用刀桿 (Holder)</h5>

                        <div class="mb-3">
                            <label for="holderSelect" class="form-label">適用於 <span id="targetSize"
                                    class="fw-bold text-danger"></span> 的刀桿：</label>
                            <select class="form-select" id="holderSelect">
                                <option selected disabled value="">請先選擇上方的刀片...</option>
                            </select>
                        </div>

                        <div id="holderInfo" class="d-none result-box">
                            <h6 class="text-success fw-bold">刀桿規格：</h6>
                            <div class="row font-monospace" style="font-size: 0.9rem;">
                                <div class="col-6">Code: <span id="holCode"></span></div>
                                <div class="col-6">Type: <span id="holType"></span></div>
                                <div class="col-6">Shank: <span id="holShank"></span></div>
                                <div class="col-6">Ød: <span id="holD"></span> mm</div>
                                <div class="col-6">L Total: <span id="holL"></span> mm</div>
                                <div class="col-6">Screw: <span id="holScrew"></span></div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>


    <script>
        // ==========================================
        // 步驟 1: 準備工作 (宣告變數 & 抓取 HTML 元素)
        // ==========================================

        // 定義「全域變數」：這兩個空陣列是用來裝等一下從 data.json 抓回來的資料。
        // 放在這裡是因為我們希望在 loadData() 裡面存入資料後，
        // 下面的監聽器 (Event Listener) 也能讀取到這些資料。
        let insertsData = [];
        let holdersData = [];

        // 取得 HTML 頁面上的元素 (DOM 節點)，把這些元素存成變數，方便等一下用程式控制它們。
        const partsSelect = document.getElementById('partsSelect');   // 第一個下拉選單 (刀片)
        const holderSelect = document.getElementById('holderSelect'); // 第二個下拉選單 (刀桿)
        const holderSection = document.getElementById('holderSection'); // 包住刀桿選單的整個區塊 (預設是變淡/不能點的)


        // ==========================================
        // 步驟 2: 把資料抓進來 (Fetch Data)
        // ==========================================

        // 定義一個「非同步」函式 (async)：
        // 因為去讀取檔案需要時間，我們必須告訴電腦「這一步要等一下 (await)」，不能直接往下衝。
        async function loadData() {
            try {
                // 1. 發出請求：去跟 data.json 這個檔案要資料
                // fetch 就像是派一個快遞員去拿貨
                // const response = await fetch('../data.json');
                const response = await fetch('https://ulysses-li.github.io/Nine-9/JSON/data.json');

                // 2. 轉換格式：快遞拿回來的東西是純文字，我們要把它轉成 JavaScript 看得懂的物件 (JSON)
                const data = await response.json();

                // 3. 存入變數：把整理好的資料，分別存進我們最上面宣告的全域變數裡
                insertsData = data.inserts;
                holdersData = data.holders;

                // 在控制台印出來，確認資料有沒有抓成功 (開發時除錯用)
                console.log('資料拉取成功！', data);

                // 4. 初始化選單：資料拿到手了，現在才可以開始建立第一個選單的選項
                initPartsMenu();

            } catch (error) {
                // 如果讀取失敗 (例如檔名打錯、沒有用 Live Server)，會執行這裡
                console.error('資料讀取失敗:', error);
                alert('無法讀取資料，請確認是否使用了 Live Server 開啟網頁？');
            }
        }

        // 這個函式負責：把所有「刀片」資料填入第一個下拉選單
        function initPartsMenu() {
            // 使用 forEach 迴圈：把 insertsData 裡的每一筆資料 (item) 拿出來跑一次
            insertsData.forEach(item => {
                // 1. 建立一個新的 <option> 標籤
                const option = document.createElement('option');

                // 2. 設定這個選項背後代表的值 (Value)，通常用唯一的 Code
                option.value = item.code;

                // 3. 設定使用者在選單上看到的文字 (Text)，這裡顯示 Parts No.
                option.textContent = item.parts_no;

                // 4. 把這個做好的 option 塞進 partsSelect (刀片選單) 裡面
                partsSelect.appendChild(option);
            });
        }

        // 馬上執行上面的 loadData 函式，程式一跑起來就去抓資料
        loadData();


        // ==========================================
        // 步驟 3: 當使用者選擇「刀片」時 (邏輯核心)
        // ==========================================

        // 監聽器：當 partsSelect (刀片選單) 發生 'change' (改變選擇) 事件時，執行裡面的程式
        partsSelect.addEventListener('change', function () {

            // 1. 抓取使用者剛剛選了哪個值 (也就是 item.code)
            const selectedCode = this.value;

            // 2. 去資料庫 (insertsData) 裡面找：
            // 幫我找出 (find) 哪一筆資料的 code 等於 使用者選的 selectedCode
            const insert = insertsData.find(i => i.code === selectedCode);

            // 如果有找到這筆資料 (以防萬一)
            if (insert) {
                // === 更新畫面顯示區 ===
                // 把這筆刀片的詳細資料 (Code, Size, Coating...) 填入對應的 HTML 位置
                document.getElementById('insCode').textContent = insert.code;
                document.getElementById('insSize').textContent = insert.size;
                document.getElementById('insCoat').textContent = insert.coating;
                document.getElementById('insGrade').textContent = insert.grade;
                document.getElementById('insPitch').textContent = `${insert.pitch_min} ~ ${insert.pitch_max} mm`; // 用樣板字串組合文字

                // 移除 'd-none' 這個 CSS class，讓原本隱藏的詳細資訊區塊顯示出來
                document.getElementById('insertInfo').classList.remove('d-none');

                // === 準備連動第二個選單 ===
                // 先重置第二個選單 (清空舊選項、讓它變成可點擊狀態)
                resetHolderSection(insert.size);

                // 3. 關鍵篩選邏輯 (Filter)：
                // 去刀桿資料庫 (holdersData) 裡面過濾，只留下那些 size 跟目前刀片一樣的刀桿
                // 例如：刀片是 CR05，我就只抓出所有 CR05 的刀桿
                const compatibleHolders = holdersData.filter(h => h.size === insert.size);

                // 4. 把篩選出來的適用刀桿，填入第二個選單 (holderSelect)
                compatibleHolders.forEach(h => {
                    const option = document.createElement('option');
                    option.value = h.code;
                    // 顯示文字組合：型號 + (直徑)
                    option.textContent = `${h.type} (Ø${h.d})`;
                    holderSelect.appendChild(option);
                });
            }
        });


        // ==========================================
        // 步驟 4: 當使用者選擇「刀桿」時
        // ==========================================

        // 監聽器：當 holderSelect (刀桿選單) 改變時
        holderSelect.addEventListener('change', function () {
            const selectedCode = this.value;

            // 一樣去資料庫找，這次找的是 holdersData
            const holder = holdersData.find(h => h.code === selectedCode);

            if (holder) {
                // 把找到的刀桿資料填入下方的顯示區
                document.getElementById('holCode').textContent = holder.code;
                document.getElementById('holType').textContent = holder.type;
                document.getElementById('holShank').textContent = holder.shank;
                document.getElementById('holD').textContent = holder.d;
                document.getElementById('holL').textContent = holder.l;
                document.getElementById('holScrew').textContent = holder.screw;

                // 讓刀桿資訊區顯示出來
                document.getElementById('holderInfo').classList.remove('d-none');
            }
        });

        // 小工具函式：用來重置刀桿區塊的狀態
        // (每次換刀片時，都要把刀桿區清空，才不會混到上一次的篩選結果)
        function resetHolderSection(size) {
            // 把透明度改回 1 (不透明)，讓使用者知道這裡可以用了
            holderSection.style.opacity = "1";
            // 恢復滑鼠點擊功能 (原本 style="pointer-events: none;")
            holderSection.style.pointerEvents = "auto";

            // 更新提示文字，告訴使用者現在是選配什麼尺寸的刀桿 (例如：適用於 CR05 的刀桿)
            document.getElementById('targetSize').textContent = size;

            // 清空下拉選單的所有選項，只留第一行提示語 "請選擇適用的刀桿..."
            holderSelect.innerHTML = '<option selected disabled>請選擇適用的刀桿...</option>';

            // 把下方的詳細資訊區塊再次藏起來 (加回 d-none)
            document.getElementById('holderInfo').classList.add('d-none');
        }
    </script>


</body>


</html>

